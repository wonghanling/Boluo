# 虎皮椒支付集成说明

本项目已集成虎皮椒支付系统，支持用户在线支付购买服务套餐。

## 🎯 支付流程

1. **用户选择服务** - 点击服务卡片（ChatGPT Plus 或 Claude Code）
2. **选择套餐** - 在弹窗中选择价格套餐
3. **发起支付** - 点击"立即支付"按钮
4. **跳转支付页面** - 系统调用虎皮椒API生成支付链接
5. **完成支付** - 用户在虎皮椒页面完成支付
6. **回调处理** - 系统接收支付回调并处理订单

## 🔧 集成文件说明

### API接口文件
- `app/api/payment/route.ts` - 支付创建接口
- `app/api/payment/notify/route.ts` - 支付回调处理接口

### 前端支付逻辑
- `app/page.tsx` - 包含支付处理函数 `handlePayment()`

### 环境变量配置
- `.env.example` - 环境变量模板
- `.env.local` - 本地开发配置（需要您填入实际密钥）

## 🔑 环境变量配置

在部署平台的环境变量设置中添加以下配置：

```bash
# 虎皮椒支付配置
XUNHUPAY_APPID=您的虎皮椒APPID
XUNHUPAY_SECRET=您的虎皮椒密钥

# 网站基础URL（用于支付回调）
NEXT_PUBLIC_BASE_URL=https://您的域名.com
```

### 本地开发配置

复制 `.env.example` 为 `.env.local`，然后填入您的虎皮椒配置：

```bash
cp .env.example .env.local
```

编辑 `.env.local` 文件：
```bash
NEXT_PUBLIC_BASE_URL=http://localhost:3000
XUNHUPAY_APPID=您的虎皮椒APPID
XUNHUPAY_SECRET=您的虎皮椒密钥
```

## 📱 支持的服务套餐

### ChatGPT Plus 代充（4个套餐）
1. 免费版代开通 - ¥35
2. 共享版 - ¥65/月（热门）
3. 独享代充 - ¥169/月
4. Pro专业版 - ¥1500/月

### Claude Code 代申请（4个套餐）
1. 新号申请 - ¥29（一次性）
2. 日付套餐 - ¥13/天
3. 周付套餐 - ¥130/周（热门）
4. 月付套餐 - ¥320/月

**总计：8个可支付的套餐卡片**

## 🔒 安全特性

- ✅ MD5签名验证
- ✅ 订单号唯一性校验
- ✅ 金额格式验证
- ✅ 环境变量保护密钥
- ✅ 错误处理和日志记录

## 📋 订单处理逻辑

当收到支付成功回调时，系统会：

1. **验证签名** - 确保请求来自虎皮椒
2. **检查订单状态** - 状态为 'OD' 表示支付成功
3. **记录日志** - 记录支付成功信息
4. **处理订单**（待扩展）：
   - 更新订单状态为已支付
   - 根据服务类型开通对应服务
   - 发送邮件/微信通知用户

## 🚀 部署注意事项

### Vercel 部署
在 Vercel 项目设置中添加环境变量：
- `XUNHUPAY_APPID`
- `XUNHUPAY_SECRET`
- `NEXT_PUBLIC_BASE_URL`

### 其他平台部署
确保在部署平台的环境变量设置中添加上述三个配置项。

## 🧪 测试流程

1. **本地测试**：
   ```bash
   npm run dev
   ```
   访问 http://localhost:3000

2. **选择服务并测试支付**：
   - 点击 ChatGPT Plus 或 Claude Code 服务
   - 选择任意套餐
   - 点击"立即支付"
   - 检查是否正确跳转到虎皮椒支付页面

3. **检查回调**：
   - 查看服务器日志确认回调接收正常

## 📞 技术支持

如有支付集成问题，请检查：
1. 环境变量是否正确配置
2. 虎皮椒账户是否正常
3. 回调URL是否可访问
4. 签名算法是否正确

## 🔄 后续扩展

支付集成完成后，您可以继续添加：
- 订单数据库存储
- 用户邮件通知
- 服务自动开通
- 支付记录查询
- 退款处理等功能